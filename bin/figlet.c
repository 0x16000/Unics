#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#define FONT_HEIGHT 7

// Now the order is:
// A-Z (0-25), space(26), punctuation (27-37), digits (38-47)

static const char *figlet_italic_font[48][FONT_HEIGHT] = {
    // A-Z (0-25) same as before
    {
        "    ___   ",
        "   / _ \\  ",
        "  / /_\\ \\ ",
        "  |  _  | ",
        "  | | | | ",
        "  \\_| |_/ ",
        "          "
    }, // A
    {
        "  ____   ",
        " | __ )  ",
        " |  _ \\  ",
        " | |_) | ",
        " |____/  ",
        "         ",
        "         "
    }, // B
    {
        "   ____  ",
        "  / ___| ",
        " | |     ",
        " | |___  ",
        "  \\____| ",
        "         ",
        "         "
    }, // C
    {
        "  ____   ",
        " |  _ \\  ",
        " | | | | ",
        " | |_| | ",
        " |____/  ",
        "         ",
        "         "
    }, // D
    {
        "  _____  ",
        " | ____| ",
        " |  _|   ",
        " | |___  ",
        " |_____| ",
        "         ",
        "         "
    }, // E
    {
        "  _____  ",
        " |  ___| ",
        " | |_    ",
        " |  _|   ",
        " |_|     ",
        "         ",
        "         "
    }, // F
    {
        "   ____  ",
        "  / ___| ",
        " | |  _  ",
        " | |_| | ",
        "  \\____| ",
        "         ",
        "         "
    }, // G
    {
        "  _   _  ",
        " | | | | ",
        " | |_| | ",
        " |  _  | ",
        " |_| |_| ",
        "         ",
        "         "
    }, // H
    {
        "  ___  ",
        " |_ _| ",
        "  | |  ",
        "  | |  ",
        " |___| ",
        "       ",
        "       "
    }, // I
    {
        "      _ ",
        "     | |",
        "  _  | |",
        " | |_| |",
        "  \\___/ ",
        "        ",
        "        "
    }, // J
    {
        "  _  __",
        " | |/ /",
        " | ' / ",
        " | . \\ ",
        " |_|\\_\\",
        "       ",
        "       "
    }, // K
    {
        "  _     ",
        " | |    ",
        " | |    ",
        " | |___ ",
        " |_____|",
        "        ",
        "        "
    }, // L
    {
        "  __  __ ",
        " |  \\/  |",
        " | |\\/| |",
        " | |  | |",
        " |_|  |_|",
        "         ",
        "         "
    }, // M
    {
        "  _   _ ",
        " | \\ | |",
        " |  \\| |",
        " | |\\  |",
        " |_| \\_|",
        "        ",
        "        "
    }, // N
    {
        "   ___   ",
        "  / _ \\  ",
        " | | | | ",
        " | |_| | ",
        "  \\___/  ",
        "         ",
        "         "
    }, // O
    {
        "  ____  ",
        " |  _ \\ ",
        " | |_) |",
        " |  __/ ",
        " |_|    ",
        "        ",
        "        "
    }, // P
    {
        "   ___   ",
        "  / _ \\  ",
        " | | | | ",
        " | |_| | ",
        "  \\__\\_\\ ",
        "         ",
        "         "
    }, // Q
    {
        "  ____  ",
        " |  _ \\ ",
        " | |_) |",
        " |  _ < ",
        " |_| \\_\\",
        "        ",
        "        "
    }, // R
    {
        "  ____  ",
        " / ___| ",
        " \\___ \\ ",
        "  ___) |",
        " |____/ ",
        "        ",
        "        "
    }, // S
    {
        "  _____ ",
        " |_   _|",
        "   | |  ",
        "   | |  ",
        "   |_|  ",
        "        ",
        "        "
    }, // T
    {
        "  _   _ ",
        " | | | |",
        " | | | |",
        " | |_| |",
        "  \\___/ ",
        "        ",
        "        "
    }, // U
    {
        " __     __",
        " \\ \\   / /",
        "  \\ \\ / / ",
        "   \\ V /  ",
        "    \\_/   ",
        "         ",
        "         "
    }, // V
    {
        " __      __",
        " \\ \\ /\\ / /",
        "  \\ V  V / ",
        "   \\_/\\_/  ",
        "           ",
        "           ",
        "           "
    }, // W
    {
        " __  __ ",
        " \\ \\/ / ",
        "  >  <  ",
        " /_/\\_\\ ",
        "        ",
        "        ",
        "        "
    }, // X
    {
        " __   __",
        " \\ \\ / /",
        "  \\ V / ",
        "   | |  ",
        "   |_|  ",
        "        ",
        "        "
    }, // Y
    {
        "  ____ ",
        " |__  /",
        "   / / ",
        "  / /_ ",
        " /____|",
        "       ",
        "       "
    }, // Z
    // Space (26)
    {
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   "
    },
    // ! (27)
    {
        "  _  ",
        " | | ",
        " | | ",
        " | | ",
        " |_| ",
        " (_) ",
        "     "
    },
    // . (28)
    {
        "     ",
        "     ",
        "     ",
        "     ",
        " ___ ",
        "|___|",
        "     "
    },
    // , (29)
    {
        "     ",
        "     ",
        "     ",
        "     ",
        "  __ ",
        " (__)",
        "  /  "
    },
    // / (30)
    {
        "     __",
        "    / /",
        "   / / ",
        "  / /  ",
        " /_/   ",
        "       ",
        "       "
    },
    // ? (31)
    {
        "  ___  ",
        " |__ \\ ",
        "    ) |",
        "   / / ",
        "   |_| ",
        "   (_) ",
        "       "
    },
    // : (32)
    {
        "     ",
        "  _  ",
        " (_) ",
        "     ",
        "  _  ",
        " (_) ",
        "     "
    },
    // ; (33)
    {
        "     ",
        "  _  ",
        " (_) ",
        "     ",
        "  _  ",
        " (_) ",
        "  /  "
    },
    // ' (34)
    {
        "  _ ",
        " | |",
        " | |",
        "    ",
        "    ",
        "    ",
        "    "
    },
    // " (35)
    {
        " _ _ ",
        "| | |",
        "     ",
        "     ",
        "     ",
        "     ",
        "     "
    },
    // - (36)
    {
        "       ",
        "       ",
        " _____ ",
        "|_____|",
        "       ",
        "       ",
        "       "
    },
    // _ (37)
    {
        "       ",
        "       ",
        "       ",
        "       ",
        " _____ ",
        "|_____|",
        "       "
    },
    // Numbers 0-9 (38-47)
    {
        "  ___  ",
        " / _ \\ ",
        "| | | |",
        "| | | |",
        "| |_| |",
        " \\___/ ",
        "       "
    }, // 0
    {
        " __ ",
        "/_ |",
        " | |",
        " | |",
        " | |",
        " |_|",
        "    "
    }, // 1
    {
        " ___  ",
        "|__ \\ ",
        "   ) |",
        "  / / ",
        " / /_ ",
        "|____|",
        "      "
    }, // 2
    {
        " ____  ",
        "|___ \\ ",
        "  __) |",
        " |__ < ",
        " ___) |",
        "|____/ ",
        "       "
    }, // 3
    {
        " _  _   ",
        "| || |  ",
        "| || |_ ",
        "|__   _|",
        "   | |  ",
        "   |_|  ",
        "        "
    }, // 4
    {
        " _____ ",
        "| ____|",
        "| |__  ",
        "|___ \\ ",
        " ___) |",
        "|____/ ",
        "       "
    }, // 5
    {
        "   __  ",
        "  / /  ",
        " / /_  ",
        "| '_ \\ ",
        "| (_) |",
        " \\___/ ",
        "       "
    }, // 6
    {
        " ______ ",
        "|____  |",
        "    / / ",
        "   / /  ",
        "  / /   ",
        " /_/    ",
        "        "
    }, // 7
    {
        "  ___  ",
        " ( _ ) ",
        " / _ \\ ",
        "| (_) |",
        " \\___/ ",
        "       ",
        "       "
    }, // 8
    {
        "  ___  ",
        " / _ \\ ",
        "| (_) |",
        " \\__, |",
        "   / / ",
        "  /_/  ",
        "       "
    }  // 9
};

static int char_to_index(char c) {
    if (c >= 'A' && c <= 'Z')
        return c - 'A';
    if (c >= 'a' && c <= 'z')
        return c - 'a';

    if (c == ' ')
        return 26;

    switch (c) {
        case '!': return 27;
        case '.': return 28;
        case ',': return 29;
        case '/': return 30;
        case '?': return 31;
        case ':': return 32;
        case ';': return 33;
        case '\'': return 34;
        case '"': return 35;
        case '-': return 36;
        case '_': return 37;
        case '0': return 38;
        case '1': return 39;
        case '2': return 40;
        case '3': return 41;
        case '4': return 42;
        case '5': return 43;
        case '6': return 44;
        case '7': return 45;
        case '8': return 46;
        case '9': return 47;
        default:
            return -1;
    }
}

char* join_args(int argc, char **argv) {
    // Calculate total length with spaces
    int total_len = 0;
    for (int i = 1; i < argc; i++) {
        total_len += strlen(argv[i]);
        if (i != argc - 1)
            total_len++; // for space
    }

    char *result = malloc(total_len + 1);
    if (!result) {
        fprintf(stderr, "Memory allocation failed\n");
        exit(1);
    }

    result[0] = '\0';  // start empty string

    for (int i = 1; i < argc; i++) {
        strcat(result, argv[i]);
        if (i != argc - 1)
            strcat(result, " ");
    }

    return result;
}

int figlet_main(int argc, char **argv) {
    if (argc < 2) {
        printf("Usage: figlet text\n");
        return 0;
    }

    char *text = join_args(argc, argv);

    size_t len = strlen(text);

    for (int row = 0; row < FONT_HEIGHT; row++) {
        for (size_t i = 0; i < len; i++) {
            int idx = char_to_index(text[i]);
            if (idx == -1) {
                printf(" ???  ");
            } else {
                printf("%s ", figlet_italic_font[idx][row]);
            }
        }
        printf("\n");
    }

    free(text);

    return 0;
}
